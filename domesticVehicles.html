<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Granični promet u RH</title>

    <link rel="icon" href="./images/graph.png">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/6aa1bd9ffa.js" crossorigin="anonymous"></script> 
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

</head>
<body>
    <div class="jumbotron">
        <h3 class="text-center">Cestovni granični promet putničkih motornih vozila</h3>
        <h6 class="text-center">Teritorij: <span>Republika Hrvatska</span></h6>
    </div>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="#"><i class="fas fa-chart-bar"></i></a>
          </div>
          <ul class="nav navbar-nav">
            <li class="active"><a href="domesticVehicles.html">Domaća vozila</a></li>
            <li><a href="foreignVehicles.html">Strana vozila</a></li>
          </ul>
        </div>
      </nav>


    <div class="container">
        <h4>Ulaz u Republiku Hrvatsku || Broj pređenih vozila: <span style="color:darkgreen; font-weight: bold;"></span></h4>
        <script>
            var data1 = [
                {"id": 1, "type":"domaca_ulaz", "vehicle":"car", "year": 2010, "number": 7430},
                {"id": 2, "type":"domaca_ulaz", "vehicle":"car", "year": 2011, "number": 7087},
                {"id": 3, "type":"domaca_ulaz", "vehicle":"car", "year": 2012, "number": 6836},
                {"id": 4, "type":"domaca_ulaz", "vehicle":"car", "year": 2013, "number": 7039},
                {"id": 5, "type":"domaca_ulaz", "vehicle":"car", "year": 2014, "number": 7457},
                {"id": 6, "type":"domaca_ulaz", "vehicle":"car", "year": 2015, "number": 7634},
                {"id": 7, "type":"domaca_ulaz", "vehicle":"car", "year": 2016, "number": 7971},
                {"id": 8, "type":"domaca_ulaz", "vehicle":"car", "year": 2017, "number": 8446},
                {"id": 9, "type":"domaca_ulaz", "vehicle":"car", "year": 2018, "number": 8462},
                {"id": 10, "type":"domaca_ulaz", "vehicle":"car", "year": 2019, "number": 8769}
            ]

            var data2 = [
                {"id": 1, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2010, "number": 81},
                {"id": 2, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2011, "number": 76},
                {"id": 3, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2012, "number": 73},
                {"id": 4, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2013, "number": 79},
                {"id": 5, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2014, "number": 87},
                {"id": 6, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2015, "number": 86},
                {"id": 7, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2016, "number": 83},
                {"id": 8, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2017, "number": 93},
                {"id": 9, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2018, "number": 95},
                {"id": 10, "type":"autobusi_ulaz", "vehicle":"bus", "year": 2019, "number": 96}
            ]

            var data = [];
            for(let i in data1) {
                data.push(data1[i].number);
            }

            var color = d3.scale.ordinal()
            .domain(data1)
            .range( [d3.rgb("#CD5C5C"), d3.rgb("#F08080"), d3.rgb("#FA8072"), d3.rgb("#E9967A"), d3.rgb("#FFA07A")])

            var margin = {top: 20, bottom: 70, left: 80, right: 20};
            var svgWidth = 500 - margin.left - margin.right;
            var svgHeight = 400 - margin.top - margin.bottom;
            var barPadding = 15;
            var barWidth = svgWidth / data1.length - barPadding;



            var svg = d3.select("body div.container")
                        .append("svg")
                        .attr("width", svgWidth + margin.left + margin.right)
                        .attr("height", svgHeight + margin.top + margin.bottom)
                        .attr("style", "background-color: lightgreen")
                        .append("g")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


            //kreiranje ordinalne skale za x-os
            var x = d3.scale.ordinal()
                .domain(d3.range(data.length)) //[0,1,2,3,4,5,7,8,9]
                .rangeRoundBands([0, svgWidth]); //prebacuje domenu u navedenom rasponu od 0 do širine svg-a

            //dodavanje skale na x-os
            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom")
                .tickFormat(function(i) {return data1[i].year + "."; });

            //učitavanje x osi popraćeno animacijom u trajanju od 1s
            svg.append("g")
                .attr("transform", "translate(0," + svgHeight + ")") //da ovog nema skala bi bila gore a ne dolje
                .transition()
                .duration(1000)
                .call(xAxis)
                .style("stroke", "darkgreen");

            //za naziv x osi
            svg.append("text")
                .attr("x", (svgWidth / 2))
                .attr("y", (svgHeight + (margin.bottom / 2)))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Godina [2010. - 2019.]")
                .style("stroke", "red")
                .style("stroke-width", ".5px");

            var y = d3.scale.linear()
                .domain([0, d3.max(data)+1000]) // 0, 8769 u ovom slučaju
                .range([svgHeight, 0]); //graf se prostire do točke svgHeight, drugim parametrom se sužava

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(function(i) { return i;});

            //Animacija učitavanja y osi u trajanju od 1s
            svg.append("g")
                .transition()
                .duration(1000)
                .call(yAxis)
                .attr("class", "yaxis")
                .style("stroke", "darkgreen")

            //za naziv y-osi
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("x",0 - (svgHeight / 2))
                .attr("y", 0 - margin.left)
                .attr("dy", "1.5em")
                .style("text-anchor", "middle")
                .text("Broj automobila")
                .style("stroke", "red")
                .style("stroke-width", ".5px");

            //postavljanje bar chart-a
            var barchart = svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                .attr("x", function(d, i) {return x(i) + 10; })
                .attr("y", function(d) { return y(0)})
                .attr("height", function(d) { return svgHeight - y(0); })
                .attr("width", barWidth)
                .attr("opacity", "90%")
                .attr("fill", function(i) { return color(i)});

            //Animacija postavljanja elemenata grafa u trajanju od 1s
            svg.selectAll("rect")
                .transition()
                .duration(1000)
                .attr("y", function(d) { return y(d)})
                .attr("height", function(d) { return (svgHeight - y(d));})
                .delay(function (d, i) {console.log(i); return i*100;})

            //na mouseover prikazuje se broj vozila u <span> elementu
            svg.selectAll("rect")
                .on("mouseover", function(d) {
                    d3.select(this)
                        .attr("fill", function(i) { return color(i)})
                        .attr("opacity", "50");
                    d3.select("body div.container h4 span")
                        .text(d);
                })
                //na mouseout prikazuje briše se prikaz iz <span> elementa
                .on("mouseout", function() {
                    d3.select(this)
                        .attr("fill", function(i) { return color(i)})
                        .attr("opacity", "90%");
                    d3.select("body div.container h4 span")
                        .text("");
                })
        </script>
    </div>
</body>
</html>